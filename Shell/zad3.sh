# Да се напише Shell скрипта која како аргумент од командна линија добива еден телефонски број
# (низа од 9 цифри која започнува со 07). Скриптата треба да ја повика Python скриптата од претходно со
# секоја една датотека што ќе ја најде во тековниот директориум со екстензија „.рр“. Скриптата треба да
# провери за секоја една датотека дали воопшто го има телефонскиот број што го добива како аргумент и
# доколку го има, да го отпечати името на корисникот на тој телефонски број.


#!/bin/bash

if [[ $# -ne 1 ]]; then
# Проверува дали бројот на аргументи подадени на скриптата НЕ е еднаков на 1.
# Ако аргументот (телефонски број) не е внесен, ќе го изврши телото на if.
    echo "Nemate vneseno tel broj"
    exit 1

fi

if echo "$1" | grep -v -q "^07[0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"; then
# Извршува проверка дали првиот аргумент ($1) НЕ одговара на шаблонот:
# - започнува со 07
# - следат точно 7 цифри (0-9)
# Со `grep -v` се прави негативна проверка (ако не одговара на шаблонот),
# `-q` тивко извршување (без печатење).
# Ако не е валиден, тогаш изврши го телото на if.

    echo "Nevaliden tel broj"
    # Испечатува порака за невалиден телефонски број.

    exit 1
    # Прекинува ја скриптата со статус 1.

fi
# Крај на вториот if услов.

tel_broj=$1
# Го зачувува телефонскиот број од аргументот во променливата tel_broj.

found=0
# Го иницијализира флагот found со 0, за да бележи дали е пронајден бројот.

for file in *.rr; do
# Почнува циклус кој оди низ сите датотеки со екстензија .rr во тековниот директориум.

    if [[ -f "$file" ]]; then
    # Проверува дали моменталниот елемент е редовна датотека (не директориум).

        result=$(python3 zad3.py "$file" | grep "$tel_broj")
        # Извршува Python скрипта zad3.py со аргумент моменталната датотека.
        # Излезот го филтрира преку grep за да се најде телефонскиот број.
        # Резултатот се зачувува во променливата result.

        if [[ -n "$result" ]]; then
        # Ако променливата result не е празна (значи бројот е најден),

            echo "Tel broj: $tel_broj e pronajden vo dat $file"
            # Испечатува порака дека бројот е пронајден во дадената датотека.

            echo "$result"
            # Испечатува информација од резултатот (најверојатно името на корисникот).

            found=1
            # Поставува флаг found на 1 за да се означи дека бројот е пронајден.

        fi
        # Крај на if проверката за резултат.

    fi
    # Крај на проверката дали е редовна датотека.

done
# Крај на циклусот за сите .rr датотеки.

if [[ $found -eq 0 ]]; then
# Ако флагот found е сè уште 0 (не е пронајден бројот во ниту една датотека),

    echo "Tel broj $tel_broj ne e pronajden"
    # Испечатува порака дека бројот не е пронајден.

fi
# Крај на последниот if услов.
